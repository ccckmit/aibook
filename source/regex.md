#   JavaScript  與正規表達式

正規語法 (Regular Grammar) 是一種相當簡單的語法，這種語法被 Perl    語言成功的用於字串比對，接著成為重要的程式設計工具。
此種標準的正規語法後來被稱為正則表達式   (Regular    Expression)。目前，大部分的語言都已納入正則表達式的函式庫，
正規表達是可以說是程式設計師必定要瞭解的工具，也就是常識的一部分。系統程式設計師更應該要瞭解正則表達式，
因為正規語法是程式語言當中，用來描述基本詞彙  (Vocabulary)，並據以建構詞彙掃描器   (Lexer) 的基礎語法，
Lexer   是編譯器的基本元件之一。

假如我們要用正則表達式描述整數數字，那麼，可以用    [0123456789]+   這個表達式，其中的中括號    [   與 ]   會框住一群
字元，用來代表字元群，加號 +   所代表的是重複   1   次或以上，因此，該表達式就可以描述像  3702451 這樣的數字。
然而，在正則表達式中，為了更方便撰寫，於是允許用    [0-9]+  這樣的式子表達同樣的概念，其中的    0-9 其實就
代表了   0123456789  等字元，這是一種簡便的縮寫法。甚至，可以再度縮短後以  [\d]+   代表，其中的  \d  就代表
數字所成的字元集合。

利用範例學習是理解正則表達式的有效方法，表格  1   就顯示了一些具有代表性的正則表達式範例。

表格  1.  正則表達式的範例

語法                  正規表達式                     範例
------------------    ---------------------------     -----------------------------------------------------
整數                  [0-9]+                          3704
有小數點的實數        [0-9]+\.[0-9]+                  7.93
英文詞彙              [A-Za-z]+                       Code
變數名稱              [A-Za-z_][A-Za-z0-9_]*          _counter
Email                 [a-zA-Z0-9_]+@[a-zA-Z0-9\._]+   ccc@kmit.edu.tw
URL                   http://[a-zA-Z0-9\./_]+         http://ccc.kmit.edu.tw/mybook/

為了協助讀者理解這些範例，我們有必要對範例中的一些正規表達式符號進行說明。

在實數的範例中，使用 `\.` 代表小數點符號 `.`，不熟悉正則表達式的讀者一定覺得奇怪，為何要加上斜線符號 `\` 呢？
這是因為在正則表達式當中，有許多符號具有特殊意義，例如點符號 `.` 是用來表示任意字元的，星號  `*` 是代表 0 次
或以上，加號 + 代表一次或以上，在正則表達式當中，有許多這類的特殊字元，因此用斜線 \ 代表跳出字元，就像
C 語言當中 printf 函數內的用途一樣。因此，當我們看到 \ 符號時，必須繼續向後看，才能知道其所代表的意義。表格  2   列出了正則表達式當中大部份的重要符號之意義，以供讀者參考。

表格  2.  正則表達式當中的符號之意義

字元            描述
------          ------------------------------------------------------------------------------------------------------------
^               比對開始位置
$               比對結束位置。
*               零次或以上
+               一次或以上
?               零次或一次
{n}             n 次。
{n,}            n 次或以上
{n,m}           n 到 m 次
?               非貪婪模式
.               比對除"\n"之外字元
(?:pattern)     比對 pattern 樣式 
(?=pattern)     正向預查，例如，"Windows (?=95|98|NT|2000)" 可比對到 "Windows 2000" 中的 "Windows"，但不能比對 Windows XP 中的 Windows。
(?!pattern)     負向預查，例如   "Windows(?!95|98|NT|2000)" 能比對 "Windows XP"中的 "Windows"，但不能比對 "Windows 2000" 中  的"Windows"。
x|y             比對 x 或 y。
[xyz]           包含 xyz 等字元。
[^xyz]          不包含 xyz 等字元。
[a-z]           字元範圍 a-z。
[^a-z]          不包含字元範圍 a-z。
\\b             比對一個單詞邊界，也就是指單詞和空格間的位置。例如，"er\b"可以比對"never"中的"er"，但不能比對"verb"中的"er"。
\\B             比對非單詞邊界。"er\B"能比對"verb"中的"er"，但不能比對"never"中的"er"。
\\cx            比對由x指明的控制字元。例如，\cM比對一個Control-M或回車符。x的值必須為A-Z或a-z之一。否則，將c視為一個原義的"c"字元。
\\d             比對一個數位字元。等價於[0-9]。
\\D             比對一個非數位字元。等價於[^0-9]。
\\f             比對一個換頁符。等價於\x0c和\cL。
\\n             比對一個分行符號。等價於\x0a和\cJ。
\\r             比對一個回車符。等價於\x0d和\cM。
\\s             比對任何空白字元，包括空格、定位字元、換頁符等等。等價於[\f\n\r\t\v]。
\\S             比對任何非空白字元。等價於[^\f\n\r\t\v]。
\\t             比對一個定位字元。等價於\x09和\cI。
\\v             比對一個垂直定位字元。等價於\x0b和\cK。
\\w             比對包括底線的任何單詞字元。等價於"[A-Za-z0-9_]"。
\\W             比對任何非單詞字元。等價於"[^A-Za-z0-9_]"。
\\xn            比對n，其中n為十六進位轉義值。十六進位轉義值必須為確定的兩個數位長。例如，"\x41"比對"A"。"\x041"則等價於"\x04"&"1"。規則運算式中可以使用ASCII編碼。
\\num           比對num，其中num是一個正整數。對所獲取的比對的引用。例如，"(.)\1"比對兩個連續的相同字元。
\\n             標識一個八進制轉義值或一個向後引用。如果\n之前至少n個獲取的子運算式，則n為向後引用。否則，如果n為八進位數字(0-7)，則n為一個八進制轉義值。
\\nm            標識一個八進制轉義值或一個向後引用。 如果\nm之前至少有nm個獲得子運算式，則nm為向後引用。如果\nm之前至少有n個獲取，則n為一個後跟文字m的向後引用。如果前面的條件都不滿足，若n和m均為八進位數字(0-7)，則\nm             將比對八進制轉義值nm。
\\nml           如果n為八進位數字(0-3)，且m和l均為八進位數字(0-7)，則比對八進制轉義值nml。
\\un            比對n，其中n是一個用四個十六進位數位表示的Unicode字元。例如，\u00A9比對版權符號（©）。

正則表達式在許多語言當中    (像是 Java,   C#, Ruby,   Python  等)    都已經有支援良好的函式庫，然而，在標準   C   語言的函式庫當中卻沒有這方面的函數，因此，我們使用 C#  這個語言說明正則表達式的用法。

範例 1.   在 Node.js (JavaScript) 當中使用正則表達式進行樣式抽取的程式範例

```javascript
var log=console.log;

var str = "name:john tel:02-3713567 email:john@abc.com age:38";
log("%j", str.match(/name:([a-zA-Z]+)/));
log("%j", str.match(/[0-9\-]{7,}/));
log("%j", str.match(/[a-zA-Z0-9]+@[a-zA-Z0-9\.]+/));
```

執行結果

```
C:\Dropbox\Public\web\ai\code\regex>node regex.js
["name:john","john"]
["02-3713567"]
["john@abc.com"]
```

